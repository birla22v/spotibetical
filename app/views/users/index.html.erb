<h1> Welcome to Spotibetical!</h1>
<header>
  <%= form_tag("user", method: "get") do %>
  <%= text_field_tag(:query, params[:query], placeholder: "Look for a song!") %>
  <%= submit_tag("Search") %>
  <% end %>
</header>
<% if user_signed_in? %>
<div class="container">
  <div class="row">
    <div class="col-md-6">
      <h3> Your search results... </h3>
      <table>
        <thead>
          <tr>
            <th>SONG</th>
            <th>ARTIST</th>
            <th>ALBUM</th>
            <th>TIME</th>
          </tr>
        </thead>
        <tbody>
          <% if @query %>
            <% @query.each do |song| %>
            <% time = song.duration_ms%>
            <% seconds=(time/1000)%60 %>
            <% if seconds < 10 %>
              <% seconds = '0'+seconds.to_s %>
            <% end %>
            <% minutes=(time/(1000*60))%60 %>
            <tr>
              <td><%=song.name%></td>
              <td><%= song.artists[0].name %></td>
              <td><%= song.album.name %></td>
              <td><%=minutes%>:<%=seconds%></td>
              <td class="col-md-2"> <%= button_to "+", songs_path(song:{
                                                                  :user_id => current_user.id,
                                                                  :name => song.name,
                                                                  :artist => song.artists[0].name}) %></td>
            </tr>
            <% end %>
          <%end%>
        </tbody>
      </table>
    </div>
    <div class="col-md-5">
      <h3> Vote for songs here! </h3>
      <table>
        <tbody>
          <% if Song.all %>
            <% Song.all.each do |song| %>
              <tr>
                <td><%= song.name %></td>
                <td><%= song.artist %></td>
                <% if song.veto != true %>
                  <td> <%= button_to "\u2191  #{song.votes.length}", song_vote_path(song:{:user_id => current_user.id,
                                                                    :name => song.name,
                                                                    :artist => song.artist}) %></td>
                <%end%>
                <% if song.veto != true && current_user.veto_remaining!=0%>
                  <td> <%= button_to "x", song_veto_path(song:{:name => song.name,
                                                             :artist => song.artist}) %>
                <%end%>
              </tr>
            <%end%>
          <%end%>
        </tbody>
    </table>
    </div>
  </div>
</div>
<% else %>
<h4> You must login to continue </h4>
<%end%>
